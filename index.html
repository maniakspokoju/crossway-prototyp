<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Crossway 1.9</title>
</head>
<body>
    <h1>Crossway 1.9.1</h1>
    <p>Wybierz swoją rolę i wpisz współrzędne (3 cyfry po przecinku)</p>

    <button id="driverBtn">Driver</button>
    <button id="passengerBtn">Passenger</button>
    <p id="role"></p>

    <div id="locationInputs" style="display:none; margin-top:10px;">
      <input type="text" id="latInput" placeholder="###">
      <input type="text" id="lngInput" placeholder="###">
      <button id="saveLocationBtn">Zapisz lokalizację</button>
    </div>

<!-- Firebase App (Core SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBO8O-tNlduXs3VPr5UV8-A1MWesj1ptrc",
  authDomain: "crossway-prototyp.firebaseapp.com",
  projectId: "crossway-prototyp",
  storageBucket: "crossway-prototyp.firebasestorage.app",
  messagingSenderId: "852476458596",
  appId: "1:852476458596:web:f901da16de7dc8a3551171",
  databaseURL: "https://crossway-prototyp-default-rtdb.europe-west1.firebasedatabase.app/"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Reset sesji dla testów
database.ref("session").remove()
  .then(() => console.log("Sesja zresetowana"))
  .catch(err => console.error("Błąd resetu sesji:", err));

let currentRole = null;

// Funkcja przydziału roli
function assignRole(role) {
  currentRole = role;
  document.getElementById("role").innerText = "Twoja rola: " + role;
  document.getElementById("locationInputs").style.display = "block";
}

// Funkcja zapisująca lokalizację (skrócone 3 cyfry po przecinku)
function saveLocation() {
  const latSuffix = document.getElementById("latInput").value;
  const lngSuffix = document.getElementById("lngInput").value;

  if(latSuffix.length !== 3 || lngSuffix.length !== 3) {
    alert("Wprowadź dokładnie 3 cyfry dla szerokości i długości!");
    return;
  }

  let lat = 52.0 + parseInt(latSuffix)/10000;  // 689 -> 0.0689
  let lng = 19.9 + parseInt(lngSuffix)/10000; // 955 -> 0.0955

  let refPath = "";
  if(currentRole === "driver") refPath = "session/driver/currentLocation";
  else if(currentRole === "passenger") refPath = "session/passenger/currentLocation";
  else return;

  database.ref(refPath).set({ latitude: lat, longitude: lng })
    .then(() => console.log(`Lokalizacja ${currentRole} zapisana:`, lat, lng))
    .catch(err => console.error(err));
}

// Obsługa przycisków
document.getElementById("driverBtn").addEventListener("click", () => assignRole("driver"));
document.getElementById("passengerBtn").addEventListener("click", () => assignRole("passenger"));
document.getElementById("saveLocationBtn").addEventListener("click", saveLocation);

</script>
</body>
</html>

