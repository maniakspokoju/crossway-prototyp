<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Crossway 1</title>
</head>
<body>
    <h1>Crossway 1.5</h1>
    <p>Sprawdzenie geolokalizacji na GitHub Pages</p>


<!-- Firebase App (Core SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<!-- Firebase Realtime Database -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBO8O-tNlduXs3VPr5UV8-A1MWesj1ptrc",
  authDomain: "crossway-prototyp.firebaseapp.com",
  projectId: "crossway-prototyp",
  storageBucket: "crossway-prototyp.firebasestorage.app",
  messagingSenderId: "852476458596",
  appId: "1:852476458596:web:f901da16de7dc8a3551171",
  databaseURL: "https://crossway-prototyp-default-rtdb.europe-west1.firebasedatabase.app/"
};



  // Inicjalizacja Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // Test połączenia: zapis i odczyt
  database.ref('test').set({msg: "Hello from prototyp!"})
    .then(() => console.log("Test zapisany do Firebase!"))
    .catch(err => console.error("Błąd zapisu:", err));

  database.ref('test').on('value', snapshot => {
    console.log("Odczyt z Firebase:", snapshot.val());
  });
</script>


    <script>

// Referencja do roli w Firebase
const roleRef = database.ref("session/roleAssigned");

// Zapis lokalizacji kierowcy do Firebase
roleRef.transaction(current => {
  if (current === null) return "driver";
  if (current === "driver") return "passenger";
  return current;
}, (error, committed, snapshot) => {
  if (error) {
    console.error("Błąd przydziału roli:", error);
  } else if (committed) {
    const role = snapshot.val();
    console.log("Twoja rola:", role);

    // Wyświetlenie roli w HTML
    let roleInfo = document.getElementById("role");
    if (!roleInfo) {
      roleInfo = document.createElement("p");
      roleInfo.id = "role";
      document.body.appendChild(roleInfo);
    }
    roleInfo.innerText = "Twoja rola: " + role;

    // Jeśli driver, zapis lokalizacji do Firebase
    if (role === "driver" && "geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(position => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        const driverRef = database.ref("session/driverLocation");
        driverRef.set({ latitude: lat, longitude: lng })
          .then(() => console.log("Lokalizacja kierowcy zapisana w Firebase!"))
          .catch(err => console.error("Błąd zapisu lokalizacji:", err));
      });
    }
  }
});

</script>

</body>
</html>
