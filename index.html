<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Crossway 1.7</title>
</head>
<body>
    <h1>Crossway 1.8</h1>
    <p>Wybierz swoją rolę i sprawdź geolokalizację</p>

    <button id="driverBtn">Driver</button>
    <button id="passengerBtn">Passenger</button>
    <p id="role"></p>

<!-- Firebase App (Core SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBO8O-tNlduXs3VPr5UV8-A1MWesj1ptrc",
  authDomain: "crossway-prototyp.firebaseapp.com",
  projectId: "crossway-prototyp",
  storageBucket: "crossway-prototyp.firebasestorage.app",
  messagingSenderId: "852476458596",
  appId: "1:852476458596:web:f901da16de7dc8a3551171",
  databaseURL: "https://crossway-prototyp-default-rtdb.europe-west1.firebasedatabase.app/"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Reset sesji dla testów
database.ref("session").remove()
  .then(() => console.log("Sesja zresetowana"))
  .catch(err => console.error("Błąd resetu sesji:", err));

// Funkcja przydziału roli
function assignRole(role) {
  const roleRef = database.ref("session/roleAssigned");
  roleRef.set(role)
    .then(() => console.log("Rola zapisana:", role))
    .catch(err => console.error("Błąd zapisu roli:", err));

  document.getElementById("role").innerText = "Twoja rola: " + role;

  // Jeśli driver, pobierz lokalizację i zapisz w Firebase
  if (role === "driver" && "geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(position => {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      const driverRef = database.ref("session/driverLocation");
      driverRef.set({ latitude: lat, longitude: lng })
        .then(() => console.log("Lokalizacja kierowcy zapisana!"))
        .catch(err => console.error("Błąd zapisu lokalizacji:", err));
    }, error => console.error("Błąd pobrania lokalizacji:", error.message));
  }
}

// Obsługa przycisków
document.getElementById("driverBtn").addEventListener("click", () => assignRole("driver"));
document.getElementById("passengerBtn").addEventListener("click", () => assignRole("passenger"));
</script>
</body>
</html>
